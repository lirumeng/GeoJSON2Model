<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
        body {
            margin: 0;
            background-color: #000;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="container"></div>

    <script src="./libs/three@0.120.1.js"></script>
    <!-- <script src="./js/script.js"></script> -->
    <script>
        let camera, scene, renderer
        let mesh

        const defaultView = {
            cp: {
                x: -24.789708296982663,
                y: 450,
                z: 70.91742526787289,
            },
            ct: {
                x: -24.789708953442272,
                y: 0.14296975330672362,
                z: 70.91697539132453,
            },
        }

        init()

        function init() {
            const container = document.getElementById('container')

            camera = new THREE.PerspectiveCamera(
                    70,
                    window.innerWidth / window.innerHeight,
                    1,
                    1000,
                )
                // camera.position.z = 400;
            camera.position.set(
                defaultView.cp.x,
                defaultView.cp.y,
                defaultView.cp.z,
            )

            scene = new THREE.Scene()

            renderer = new THREE.WebGLRenderer({
                antialias: true,
            })
            renderer.setPixelRatio(window.devicePixelRatio)
            renderer.setSize(window.innerWidth, window.innerHeight)
            container.appendChild(renderer.domElement)

            // let controls = new THREE.OrbitControls(camera, renderer.domElement)
            // controls.minDistance = 50;
            // controls.maxDistance = defaultView.cp.y;
            // controls.enableDamping = false;
            // controls.enableKeys = false;
            // controls.target = new THREE.Vector3(defaultView.ct.x, defaultView.ct.y, defaultView.ct.z);

            window.addEventListener('resize', onWindowResize)
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight
            camera.updateProjectionMatrix()

            renderer.setSize(window.innerWidth, window.innerHeight)
        }

        fetch('map_huadong.json')
            .then((res) => res.json())
            .then((res) => {
                let jsonData = json && json.features || [];

                let shapeGroup = new THREE.Group()
                shapeGroup.name = '华东地图'
                shapeGroup.rotateX(Math.PI / 2)
                    // shapeGroup.position.y = 0.5

                jsonData.forEach((regin) => {
                    let reginGroup = new THREE.Group()

                    reginGroup.name = regin.properties.name
                    regin.geometry.coordinates.forEach((geo) => {
                        let geoPointArr = geo[0].map((item) => {
                            return changeCoordinate(Projection(item))
                        })

                        let regionMesh = this._drawRegion(geoPointArr)
                        let borderMesh = this._drawBorder(geoPointArr)

                        reginGroup.add(regionMesh)
                        reginGroup.add(borderMesh)
                    })

                    shapeGroup.add(reginGroup)
                })

                shapeGroup.visible = false;

                ShareData.huadongMapGroup = shapeGroup;
                console.log(shapeGroup)

                this.player.scene.add(shapeGroup);
            })
    </script>
</body>

</html>